import{a as T,b as P,c as E}from"./chunk-P6KFG34U.js";import"./chunk-KMUZPL3V.js";import"./chunk-VNWZKHP3.js";import"./chunk-KQUAVRFU.js";import"./chunk-WXWXYMIB.js";import{a as V}from"./chunk-C73HAMVH.js";import{k as S}from"./chunk-6WQU6EZD.js";import{k,l as y}from"./chunk-ISIAGV3U.js";import{Ab as d,Ib as o,Jb as _,Kb as v,Oa as b,Ra as c,Wa as g,_ as x,ab as w,ea as u,fa as p,fb as C,nb as h,tb as r,ub as i,vb as I,yb as f,zb as l}from"./chunk-7YWQNTIB.js";function M(n,e){n&1&&(r(0,"div",6),o(1," Your cart is empty. "),i())}function D(n,e){if(n&1){let t=f();r(0,"div",7)(1,"div",8),I(2,"img",9),r(3,"div")(4,"h3",10),o(5),i(),r(6,"p",6),o(7),i()()(),r(8,"div",11)(9,"button",12),l("click",function(){let s=u(t).$implicit,m=d();return p(m.decrease(s))}),o(10,"-"),i(),r(11,"span"),o(12),i(),r(13,"button",12),l("click",function(){let s=u(t).$implicit,m=d();return p(m.increase(s))}),o(14,"+"),i()(),r(15,"button",13),l("click",function(){let s=u(t).$implicit,m=d();return p(m.remove(s))}),o(16,"Remove"),i()()}if(n&2){let t=e.$implicit;c(2),h("src",t.product==null?null:t.product.imageCover,b)("alt",t.product==null?null:t.product.title),c(3),_(t.product==null?null:t.product.title),c(2),v("",t.price," EGP"),c(5),_(t.count)}}function O(n,e){if(n&1){let t=f();r(0,"div",14)(1,"p",15),o(2),i(),r(3,"button",16),l("click",function(){u(t);let s=d();return p(s.checkout())}),o(4,"Checkout"),i()()}if(n&2){let t=d();c(2),v("Total: ",(t.cart==null?null:t.cart.totalCartPrice)||t.getTotal()," EGP")}}var j=class n{constructor(e,t,a){this.cartService=e;this.snackBar=t;this.route=a}cartItems=[];cart=null;currentProductID=null;loader=x(V);ngOnInit(){this.loadCart()}showToast(e,t){this.snackBar.openFromComponent(P,{data:{message:e,icon:t},duration:3e3,horizontalPosition:"right",verticalPosition:"top",panelClass:["custom-snackbar"]})}loadCart(){this.loader.show(),this.cartService.getCart().subscribe(e=>{e&&e.data?(this.cart=e.data,this.cartItems=e.data.products||[]):(this.cart=null,this.cartItems=[]),this.loader.hide(),console.log("cart",this.cart),console.log("cartItems",this.cartItems)})}increase(e){this.loader.show(),console.log("Increasing item:",e),this.cartService.updateCart(e.product._id,e.count+1).subscribe({next:t=>{console.log("API response for increase:",t),e.count=t.data?.count??e.count+1,this.loadCart(),this.showToast("Item quantity increased","add_circle")},error:t=>console.error("Error increasing cart item:",t)}),this.loader.hide()}decrease(e){e.count>1?(console.log("Decreasing item:",e),this.loader.show(),this.cartService.updateCart(e.product._id,e.count-1).subscribe({next:t=>{console.log("API response for decrease:",t),e.count=t.data?.count??e.count-1,this.showToast("Item quantity decreased","remove_circle")},error:t=>console.error("Error decreasing cart item:",t)}),this.loader.hide()):this.remove(e)}remove(e){console.log("Removing item:",e),console.log("ID",e._id),this.loader.show(),this.cartService.removeCart(e._id).subscribe({next:t=>{console.log("API response for remove:",t),this.loadCart(),this.showToast("Item removed from cart","delete")},error:t=>console.error("Error removing cart item:",t)}),this.loader.hide()}getTotal(){return this.cart?.totalCartPrice||this.cartItems.reduce((e,t)=>e+t.product.price*t.count,0)}checkout(){if(!this.cart?._id){this.showToast("No cart found to checkout","error");return}sessionStorage.setItem("cartId",this.cart._id),this.showToast("Proceeding to checkout...","shopping_bag"),this.route.navigate(["/Add-Details"])}Clear(){this.loader.show(),this.cartService.clearCart().subscribe({next:e=>{console.log(e),this.loadCart(),this.loader.hide(),this.showToast("Cart cleared","delete_sweep")},error(e){console.error(e)}})}static \u0275fac=function(t){return new(t||n)(g(E),g(T),g(S))};static \u0275cmp=w({type:n,selectors:[["app-view-cart"]],decls:8,vars:3,consts:[[1,"cart","p-5","pt-10"],[1,"text-2xl","mb-4"],["class","text-gray-500",4,"ngIf"],[1,"btn","mx-auto",3,"click"],["class","cart-item flex items-center justify-between mb-4 p-4 border rounded-lg shadow-sm",4,"ngFor","ngForOf"],["class","mt-4 flex justify-between items-center",4,"ngIf"],[1,"text-gray-500"],[1,"cart-item","flex","items-center","justify-between","mb-4","p-4","border","rounded-lg","shadow-sm"],[1,"product-info","flex","items-center","gap-4"],[1,"w-16","h-16","object-contain","rounded-lg",3,"src","alt"],[1,"font-medium"],[1,"flex","items-center","gap-2"],[1,"px-2","py-1","bg-gray-200","rounded",3,"click"],[1,"px-3","py-1","bg-red-500","text-white","rounded",3,"click"],[1,"mt-4","flex","justify-between","items-center"],[1,"font-bold","text-lg"],[1,"px-5","py-2","bg-green-600","text-white","rounded","hover:bg-green-700",3,"click"]],template:function(t,a){t&1&&(r(0,"section",0)(1,"h2",1),o(2,"Your Cart"),i(),C(3,M,2,0,"div",2),r(4,"button",3),l("click",function(){return a.Clear()}),o(5,"Clear"),i(),C(6,D,17,5,"div",4)(7,O,5,1,"div",5),i()),t&2&&(c(3),h("ngIf",a.cartItems.length===0),c(3),h("ngForOf",a.cartItems),c(),h("ngIf",a.cartItems.length>0))},dependencies:[k,y],styles:[".btn[_ngcontent-%COMP%]{background-color:red;padding:10px;margin-top:15px;margin-bottom:15px;justify-self:center;align-items:center;color:#000;font-size:20px;font-weight:700;border-radius:15px;transition:all 1.5s ease-in-out}.btn[_ngcontent-%COMP%]:hover{background-color:#b30202;scale:1.2em}"]})};export{j as ViewCartComponent};
