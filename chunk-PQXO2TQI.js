import{a as y}from"./chunk-KMUZPL3V.js";import{a as M}from"./chunk-KQUAVRFU.js";import"./chunk-WXWXYMIB.js";import{k as _,l as b,u as I,v as S}from"./chunk-ISIAGV3U.js";import{Ab as f,Hb as x,Ib as o,Jb as C,Kb as c,Mb as O,Ra as a,Sb as P,U as u,Z as m,_ as h,ab as v,fb as g,nb as l,tb as i,ub as n}from"./chunk-7YWQNTIB.js";var p=class r{constructor(t,e){this.http=t;this.auth=e}URL=y.apiUrl+"orders";ensureToken(){let t=this.auth.getToken();if(!t)throw new Error("No token found");return new I().set("token",t)}createCashOrder(t,e){let d=this.ensureToken();return this.http.post(`${this.URL}/${t}`,{shippingAddress:e},{headers:d})}checkoutSession(t,e,d){let s=this.ensureToken();return this.http.post(`${this.URL}/checkout-session/${t}?url=${encodeURIComponent(d)}`,{shippingAddress:e},{headers:s})}static \u0275fac=function(e){return new(e||r)(m(S),m(M))};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};function k(r,t){if(r&1&&(i(0,"div",4),o(1),n()),r&2){let e=f();a(),c(" ",e.errorMessage," ")}}function T(r,t){if(r&1&&(i(0,"li"),o(1),n()),r&2){let e=t.$implicit;a(),O(" ",e.product.title," - ",e.count," \xD7 ",e.price," ")}}function w(r,t){if(r&1&&(i(0,"div")(1,"h3"),o(2),n(),i(3,"p"),o(4),n(),i(5,"p"),o(6),n(),i(7,"p"),o(8),n(),i(9,"h4"),o(10,"Items:"),n(),i(11,"ul"),g(12,T,2,3,"li",5),n(),i(13,"h4"),o(14,"Total Price"),n(),i(15,"p"),o(16),n()()),r&2){let e=f();a(2),c("Order ID: ",e.orderData._id,""),a(2),c("Total Price: ",e.orderData.totalOrderPrice,""),a(2),c("Payment Method: ",e.orderData.paymentMethodType,""),a(2),c("Status: ",e.orderData.isDelivered?"Delivered":"Pending",""),a(4),l("ngForOf",e.orderData.cartItems),a(4),C(e.orderData.totalOrderPrice)}}function A(r,t){r&1&&(i(0,"p"),o(1,"Placing your order..."),n())}var E=class r{orderService=h(p);orderData=null;errorMessage=null;ngOnInit(){this.createCashOrder()}createCashOrder(){let t=sessionStorage.getItem("cartId"),e=sessionStorage.getItem("shippingAddress");if(!t){this.errorMessage="No cart found in session. Please add items and checkout again.";return}if(!e){this.errorMessage="Please add a shipping address first.";return}let d=JSON.parse(e);this.orderService.createCashOrder(t,d).subscribe({next:s=>{console.log("Cash order API response:",s),this.orderData=s.data},error:s=>{console.error("Cash order error:",s),this.errorMessage="Something went wrong while placing the order."}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=v({type:r,selectors:[["app-order-placed"]],decls:7,vars:3,consts:[["loading",""],[1,"order-container","pt-10"],["class","error",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"error"],[4,"ngFor","ngForOf"]],template:function(e,d){if(e&1&&(i(0,"div",1)(1,"h2"),o(2,"Order Confirmation"),n(),g(3,k,2,1,"div",2)(4,w,17,6,"div",3)(5,A,2,0,"ng-template",null,0,P),n()),e&2){let s=x(6);a(3),l("ngIf",d.errorMessage),a(),l("ngIf",d.orderData)("ngIfElse",s)}},dependencies:[b,_],styles:[".order-container[_ngcontent-%COMP%]{max-width:400px;margin:2rem auto;padding:1rem;border:1px solid #ddd;border-radius:8px}.order-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.order-container[_ngcontent-%COMP%]   .action-box[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;flex-direction:column;gap:.5rem}.order-container[_ngcontent-%COMP%]   .action-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border-radius:4px;border:1px solid #ccc}.order-container[_ngcontent-%COMP%]   .action-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}.order-container[_ngcontent-%COMP%]   .action-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#0056b3}"]})};export{E as OrderPlacedComponent};
